# Password Manager - –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

## –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ

1. [–û–±–∑–æ—Ä](#–æ–±–∑–æ—Ä)
2. [–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫](#—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π-—Å—Ç–µ–∫)
3. [–û–±—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞](#–æ–±—â–∞—è-–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞)
4. [–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞](#—Å—Ç—Ä—É–∫—Ç—É—Ä–∞-–ø—Ä–æ–µ–∫—Ç–∞)
5. [–î–æ–º–µ–Ω–Ω—ã–µ —Å—É—â–Ω–æ—Å—Ç–∏](#–¥–æ–º–µ–Ω–Ω—ã–µ-—Å—É—â–Ω–æ—Å—Ç–∏)
6. [–û—Å–Ω–æ–≤–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã](#–æ—Å–Ω–æ–≤–Ω—ã–µ-—Å–∏—Å—Ç–µ–º—ã)
   - [–°–∏—Å—Ç–µ–º–∞ –º–æ–¥–∞–ª—å–Ω–æ—Å—Ç–∏](#—Å–∏—Å—Ç–µ–º–∞-–º–æ–¥–∞–ª—å–Ω–æ—Å—Ç–∏)
   - [–°–∏—Å—Ç–µ–º–∞ –∫–µ–π–º–∞–ø–æ–≤](#—Å–∏—Å—Ç–µ–º–∞-–∫–µ–π–º–∞–ø–æ–≤)
   - [–°–∏—Å—Ç–µ–º–∞ —Ñ–æ–∫—É—Å–∞](#—Å–∏—Å—Ç–µ–º–∞-—Ñ–æ–∫—É—Å–∞)
   - [–°–∏—Å—Ç–µ–º–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π](#—Å–∏—Å—Ç–µ–º–∞-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π)
7. [API Client](#api-client)
8. [Presentation Layer](#presentation-layer)
9. [Hooks](#hooks)
10. [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã](#–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ-–ø—Ä–∏–Ω—Ü–∏–ø—ã)

---

## –û–±–∑–æ—Ä

–ú–µ–Ω–µ–¥–∂–µ—Ä –ø–∞—Ä–æ–ª–µ–π - —ç—Ç–æ desktop –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å –ø–æ–ª–Ω–æ–π –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã. –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –º–æ–¥–∞–ª—å–Ω–æ–º —Ä–µ–∂–∏–º–µ (–Ω–∞–≤–∏–≥–∞—Ü–∏—è/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ) –∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É–µ—Ç —Å backend API –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–∞—Ä–æ–ª—è–º–∏.

### –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:

- **Keyboard-first**: –ü–æ–ª–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã
- **–ú–æ–¥–∞–ª—å–Ω–æ—Å—Ç—å**: –î–≤–∞ —Ä–µ–∂–∏–º–∞ —Ä–∞–±–æ—Ç—ã - –Ω–∞–≤–∏–≥–∞—Ü–∏—è –∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ, –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ª–µ–≥–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ —Ä–µ–∂–∏–º—ã
- **–ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–µ –∫–µ–π–º–∞–ø—ã**: –ì–æ—Ä—è—á–∏–µ –∫–ª–∞–≤–∏—à–∏ –∑–∞–≤–∏—Å—è—Ç –æ—Ç —Ç–µ–∫—É—â–µ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
- **Real-time –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å**: –°—Ç–∞—Ç—É—Å-–±–∞—Ä —Å –∞–∫—Ç–∏–≤–Ω—ã–º–∏ –∫–µ–π–º–∞–ø–∞–º–∏
- **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è**: Toast-–Ω–æ—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –æ–± –æ—à–∏–±–∫–∞—Ö –∏ —É—Å–ø–µ—à–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏—è—Ö

---

## –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

- **Platform**: Electron (desktop)
- **Frontend Framework**: Remix
- **Language**: TypeScript
- **UI**: React
- **Styling**: Tailwind CSS (–ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ—Ç—Å—è)
- **API Communication**: Fetch API / HTTP

---

## –û–±—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                  Presentation Layer                      ‚îÇ
‚îÇ         (Remix Routes + React Components)                ‚îÇ
‚îÇ                                                           ‚îÇ
‚îÇ  - ResourceList, ResourceDetail, PasswordGenerator       ‚îÇ
‚îÇ  - KeymapStatusBar, NotificationToast                   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                 ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                  Application Layer                       ‚îÇ
‚îÇ    (State Management, Modal System, Keymap System)       ‚îÇ
‚îÇ                                                           ‚îÇ
‚îÇ  - ModalManager: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–µ–∂–∏–º–∞–º–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è          ‚îÇ
‚îÇ  - KeymapRegistry & Executor: –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–µ–π–º–∞–ø–æ–≤         ‚îÇ
‚îÇ  - FocusManager: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ñ–æ–∫—É—Å–æ–º –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏        ‚îÇ
‚îÇ  - NotificationManager: –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                 ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ              Infrastructure Layer                        ‚îÇ
‚îÇ              (API Client, HTTP Service)                  ‚îÇ
‚îÇ                                                           ‚îÇ
‚îÇ  - APIClient: –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å backend API               ‚îÇ
‚îÇ  - HTTP utilities, error handling                        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Å–ª–æ–∏:

1. **Presentation Layer**: React –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã, Remix routes, UI logic
2. **Application Layer**: –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –∫–ª–∏–µ–Ω—Ç–∞, —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º, —Å–∏—Å—Ç–µ–º—ã
3. **Infrastructure Layer**: –í–Ω–µ—à–Ω–∏–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è (API, storage)

---

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

> **üìÇ –î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ —Å –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–º–∏ –≥—Ä–∞–Ω–∏—Ü–∞–º–∏ –∏ –ø—Ä–∞–≤–∏–ª–∞–º–∏ –∏–º–ø–æ—Ä—Ç–∞ –æ–ø–∏—Å–∞–Ω–∞ –≤ [PROJECT_STRUCTURE.md](../PROJECT_STRUCTURE.md)**

–û—Å–Ω–æ–≤–Ω—ã–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:

- **`app/routes/`** - Remix routes (Presentation Layer)
- **`app/components/`** - React –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã (Presentation Layer)
- **`app/core/`** - Core Systems (modal, keymap, focus, notification)
- **`app/domain/`** - Domain Layer (entities, aggregates, events)
- **`app/application/`** - Application Layer (use cases)
- **`app/infrastructure/`** - Infrastructure Layer (API, repositories, utils)
- **`app/hooks/`** - React Hooks
- **`app/types/`** - TypeScript —Ç–∏–ø—ã (re-exports)

–°–º. [PROJECT_STRUCTURE.md](../PROJECT_STRUCTURE.md) –¥–ª—è –ø–æ–ª–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –º–æ–¥—É–ª—è—Ö, –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã—Ö –≥—Ä–∞–Ω–∏—Ü–∞—Ö –∏ –ø—Ä–∞–≤–∏–ª–∞—Ö –∏–º–ø–æ—Ä—Ç–∞

---

## –î–æ–º–µ–Ω–Ω—ã–µ —Å—É—â–Ω–æ—Å—Ç–∏

### Resource (–†–µ—Å—É—Ä—Å)

–û—Å–Ω–æ–≤–Ω–∞—è —Å—É—â–Ω–æ—Å—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è - –Ω–∞–±–æ—Ä –ø–∞—Ä–æ–ª–µ–π –∏ —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö.

```typescript
interface Resource {
  id: ResourceId;
  namespace: Namespace;     // –ù–∞–ø—Ä–∏–º–µ—Ä: "social" (Value Object)
  name: ResourceName;       // –ù–∞–ø—Ä–∏–º–µ—Ä: "facebook" (Value Object)
  secret: SecretField;      // –û—Å–Ω–æ–≤–Ω–æ–π –ø–∞—Ä–æ–ª—å (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ)
  customFields: CustomField[]; // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è
  createdAt: DateTime;      // ISO date
  updatedAt: DateTime;      // ISO date
}

type ResourceId = string  // UUID

interface SecretField {
  id: string;
  label: 'secret';          // –í—Å–µ–≥–¥–∞ –∫–æ–Ω—Å—Ç–∞–Ω—Ç–∞ "secret"
  value: string;            // –ó–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
  createdAt: string;
  updatedAt: string;
}

interface CustomField {
  id: string;
  label: string;            // –ü—Ä–æ–∏–∑–≤–æ–ª—å–Ω–∞—è –º–µ—Ç–∫–∞ (email, username, etc.)
  value: string;            // –ó–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
  createdAt: string;
  updatedAt: string;
}
```

**–ö–ª—é—á–µ–≤—ã–µ –ø—Ä–∞–≤–∏–ª–∞:**
- –£ –∫–∞–∂–¥–æ–≥–æ —Ä–µ—Å—É—Ä—Å–∞ –µ—Å—Ç—å `namespace` –∏ `name` (–Ω–∞–ø—Ä–∏–º–µ—Ä: `[social]: facebook`)
- –ü–æ–ª–µ `secret` –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –∏ –≤—Å–µ–≥–¥–∞ –æ–¥–Ω–æ
- –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ `customFields`
- –í—Å–µ –∑–Ω–∞—á–µ–Ω–∏—è —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–º –≤–∏–¥–µ –Ω–∞ backend

### ResourceListItem

–£–ø—Ä–æ—â–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è —Ä–µ—Å—É—Ä—Å–∞ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ —Å–ø–∏—Å–∫–∞—Ö:

```typescript
interface ResourceListItem {
  id: ResourceId;
  namespace: string;        // –ü—Ä–æ—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
  name: string;             // –ü—Ä–æ—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
  secretPreview?: string;   // –ü–µ—Ä–≤—ã–µ —Å–∏–º–≤–æ–ª—ã + ***
  fieldsCount: number;
  updatedAt: DateTime;
}
```

### Namespace (–ù–µ–π–º—Å–ø–µ–π—Å)

–ö–∞—Ç–µ–≥–æ—Ä–∏—è –¥–ª—è –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏ —Ä–µ—Å—É—Ä—Å–æ–≤:

```typescript
interface Namespace {
  name: string;             // –ù–∞–ø—Ä–∏–º–µ—Ä: "social", "work", "banking"
  resourceCount?: number;   // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ—Å—É—Ä—Å–æ–≤ –≤ —ç—Ç–æ–º –Ω–µ–π–º—Å–ø–µ–π—Å–µ
}
```

### Password Generation Options

–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø–∞—Ä–æ–ª–µ–π:

```typescript
interface PasswordGenerationOptions {
  length: number;
  includeUppercase: boolean;
  includeLowercase: boolean;
  includeNumbers: boolean;
  includeSymbols: boolean;
  excludeAmbiguous: boolean;  // –ò—Å–∫–ª—é—á–∏—Ç—å –ø–æ—Ö–æ–∂–∏–µ —Å–∏–º–≤–æ–ª—ã (O/0, l/1)
  customCharset?: string;
}

interface GeneratedPassword {
  password: string;
  strength: PasswordStrength;
}

interface PasswordStrength {
  score: number;              // 0-100
  level: 'weak' | 'fair' | 'good' | 'strong' | 'excellent';
  feedback: string[];
}
```

---

## –û—Å–Ω–æ–≤–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã

### –°–∏—Å—Ç–µ–º–∞ –º–æ–¥–∞–ª—å–Ω–æ—Å—Ç–∏

–£–ø—Ä–∞–≤–ª—è–µ—Ç —Ä–µ–∂–∏–º–∞–º–∏ —Ä–∞–±–æ—Ç—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (–Ω–∞–≤–∏–≥–∞—Ü–∏—è/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ).

#### Types

```typescript
// core/modal/types.ts

export type AppMode = 'navigation' | 'editing';

export interface ModeContext {
  mode: AppMode;
  route: RouteInfo;         // –û–±—ä–µ–∫—Ç —Å path –∏ params
  state: ModeState | null;  // –°–æ—Å—Ç–æ—è–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ —Ä–µ–∂–∏–º–∞
}

export interface RouteInfo {
  path: string;
  params: Record<string, string>;
}

export interface EditingContext {
  resourceId?: string;
  fieldId?: string;
  originalValue?: string;
}

export type ModeChangeListener = (context: ModeContext) => void;
```

#### ModalManager

Singleton –∫–ª–∞—Å—Å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–µ–∂–∏–º–∞–º–∏:

```typescript
// core/modal/ModalManager.ts

export class ModalManager {
  private mode: AppMode = 'navigation';
  private editingContext: EditingContext | null = null;
  private listeners = new Set<ModeChangeListener>();
  private route: string = '/';
  private routeParams: Record<string, string> = {};
  
  getMode(): AppMode {
    return this.mode;
  }
  
  getContext(): ModeContext {
    return {
      mode: this.mode,
      route: {
        path: this.route,
        params: this.routeParams || {}
      },
      state: this.mode === 'editing' && this.editingContext
        ? { type: 'editing', ...this.editingContext }
        : this.mode === 'navigation'
        ? { type: 'navigation', focusedElementId: null, scrollPosition: 0 }
        : null
    };
  }
  
  setRoute(route: string, params?: Record<string, string>): void {
    this.route = route;
    this.routeParams = params || {};
    this.notifyListeners();
  }
  
  enterNavigationMode(): void {
    if (this.mode === 'navigation') return;
    
    this.mode = 'navigation';
    this.editingContext = null;
    this.notifyListeners();
  }
  
  enterEditingMode(context: EditingContext): void {
    if (this.mode === 'editing') return;
    
    this.mode = 'editing';
    this.editingContext = context;
    this.notifyListeners();
  }
  
  getEditingContext(): EditingContext | null {
    return this.editingContext;
  }
  
  subscribe(listener: ModeChangeListener): () => void {
    this.listeners.add(listener);
    return () => this.listeners.delete(listener);
  }
  
  private notifyListeners(): void {
    const context = this.getContext();
    this.listeners.forEach(listener => listener(context));
  }
}

// Singleton instance
export const modalManager = new ModalManager();
```

#### ModalContext (React)

```typescript
// core/modal/ModalContext.tsx

import { createContext, useContext, useEffect, useState } from 'react';
import { modalManager } from './ModalManager';
import type { ModeContext, EditingContext, AppMode } from './types';

interface ModalContextValue {
  mode: AppMode;
  context: ModeContext;
  enterNavigationMode: () => void;
  enterEditingMode: (context: EditingContext) => void;
  getEditingContext: () => EditingContext | null;
}

const ModalContext = createContext<ModalContextValue | null>(null);

export function ModalProvider({ children }: { children: React.ReactNode }) {
  const [context, setContext] = useState<ModeContext>(modalManager.getContext());
  
  useEffect(() => {
    return modalManager.subscribe((newContext) => {
      setContext(newContext);
    });
  }, []);
  
  const value: ModalContextValue = {
    mode: context.mode,
    context,
    enterNavigationMode: () => modalManager.enterNavigationMode(),
    enterEditingMode: (ctx) => modalManager.enterEditingMode(ctx),
    getEditingContext: () => modalManager.getEditingContext()
  };
  
  return (
    <ModalContext.Provider value={value}>
      {children}
    </ModalContext.Provider>
  );
}

export function useModalContext() {
  const context = useContext(ModalContext);
  if (!context) {
    throw new Error('useModalContext must be used within ModalProvider');
  }
  return context;
}
```

#### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

```typescript
// –ü—Ä–∏–º–µ—Ä: –ü–µ—Ä–µ—Ö–æ–¥ –≤ —Ä–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ–ª—è
const { enterEditingMode } = useModalContext();

const handleEditField = (fieldId: string) => {
  enterEditingMode({
    resourceId: resource.id,
    fieldId: fieldId,
    originalValue: field.value
  });
};

// –ü—Ä–∏–º–µ—Ä: –í—ã—Ö–æ–¥ –∏–∑ —Ä–µ–∂–∏–º–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
const { enterNavigationMode } = useModalContext();

const handleCancelEdit = () => {
  enterNavigationMode();
};
```

---

### –°–∏—Å—Ç–µ–º–∞ –∫–µ–π–º–∞–ø–æ–≤

–£–ø—Ä–∞–≤–ª—è–µ—Ç –≥–æ—Ä—è—á–∏–º–∏ –∫–ª–∞–≤–∏—à–∞–º–∏ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞.

#### Types

```typescript
// core/keymap/types.ts

export interface KeyBinding {
  key: string;              // 's', 'enter', 'escape'
  ctrl?: boolean;
  shift?: boolean;
  alt?: boolean;
  meta?: boolean;
}

export interface ActionContext {
  mode: AppMode;
  route: string;            // –ü—Ä–æ—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞ –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Å keymaps
  editingContext?: EditingContext;
  focusedElement?: HTMLElement;
  
  // –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ ActionContext (Dependency Injection)
  commandBus?: ICommandBus;           // Command Bus –¥–ª—è UI –∫–æ–º–∞–Ω–¥
  modalManager?: ModalManager;
  focusManager?: FocusManager;
  notificationManager?: NotificationManager;
  
  [key: string]: any;
}

export type KeymapAction = (context: ActionContext) => void | Promise<void>;

export interface Keymap {
  id: string;
  name: string;
  binding: KeyBinding;
  action: KeymapAction;
  description: string;
  icon?: string;
  
  // –£—Å–ª–æ–≤–∏—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏
  modes: AppMode[];
  routes?: string[];        // –ï—Å–ª–∏ undefined - –∞–∫—Ç–∏–≤–µ–Ω –Ω–∞ –≤—Å–µ—Ö —Ä–æ—É—Ç–∞—Ö
  condition?: (context: ActionContext) => boolean;
}

export type KeymapChangeListener = () => void;
```

#### KeymapRegistry

–†–µ–µ—Å—Ç—Ä –≤—Å–µ—Ö –∫–µ–π–º–∞–ø–æ–≤ —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏:

```typescript
// core/keymap/KeymapRegistry.ts

import { Keymap, KeyBinding, ActionContext, KeymapChangeListener } from './types';

export class KeymapRegistry {
  private keymaps = new Map<string, Keymap>();
  private listeners = new Set<KeymapChangeListener>();
  
  register(keymap: Keymap): void {
    this.keymaps.set(keymap.id, keymap);
    this.notifyListeners();
  }
  
  unregister(keymapId: string): void {
    this.keymaps.delete(keymapId);
    this.notifyListeners();
  }
  
  registerMultiple(keymaps: Keymap[]): void {
    keymaps.forEach(keymap => this.keymaps.set(keymap.id, keymap));
    this.notifyListeners();
  }
  
  getActiveKeymaps(context: ActionContext): Keymap[] {
    return Array.from(this.keymaps.values()).filter(keymap => 
      this.isKeymapActive(keymap, context)
    );
  }
  
  findByBinding(binding: KeyBinding, context: ActionContext): Keymap | undefined {
    return this.getActiveKeymaps(context).find(keymap =>
      this.bindingsMatch(keymap.binding, binding)
    );
  }
  
  private isKeymapActive(keymap: Keymap, context: ActionContext): boolean {
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∂–∏–º–∞
    if (!keymap.modes.includes(context.mode)) {
      return false;
    }
    
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–æ—É—Ç–∞ (–µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω)
    if (keymap.routes && !this.routeMatches(keymap.routes, context.route)) {
      return false;
    }
    
    // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ —É—Å–ª–æ–≤–∏–µ
    if (keymap.condition && !keymap.condition(context)) {
      return false;
    }
    
    return true;
  }
  
  private routeMatches(patterns: string[], route: string): boolean {
    return patterns.some(pattern => {
      // –ü—Ä–æ—Å—Ç–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –∏–ª–∏ –ø–∞—Ç—Ç–µ—Ä–Ω —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
      if (pattern === route) return true;
      
      // /resources/:id -> /resources/123
      const regex = new RegExp(
        '^' + pattern.replace(/:[^/]+/g, '[^/]+') + '$'
      );
      return regex.test(route);
    });
  }
  
  private bindingsMatch(a: KeyBinding, b: KeyBinding): boolean {
    return (
      a.key === b.key &&
      (a.ctrl ?? false) === (b.ctrl ?? false) &&
      (a.shift ?? false) === (b.shift ?? false) &&
      (a.alt ?? false) === (b.alt ?? false) &&
      (a.meta ?? false) === (b.meta ?? false)
    );
  }
  
  subscribe(listener: KeymapChangeListener): () => void {
    this.listeners.add(listener);
    return () => this.listeners.delete(listener);
  }
  
  private notifyListeners(): void {
    this.listeners.forEach(listener => listener());
  }
}

export const keymapRegistry = new KeymapRegistry();
```

#### KeymapExecutor

–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–∞–∂–∞—Ç–∏–π –∫–ª–∞–≤–∏—à:

```typescript
// core/keymap/KeymapExecutor.ts

import { KeyBinding, ActionContext } from './types';
import { KeymapRegistry } from './KeymapRegistry';
import { ModalManager } from '../modal/ModalManager';

export class KeymapExecutor {
  constructor(
    private registry: KeymapRegistry,
    private commandBus: ICommandBus,     // Command Bus –¥–æ–±–∞–≤–ª–µ–Ω
    private modalManager: ModalManager,
    private focusManager: FocusManager,
    private notificationManager: NotificationManager
  ) {
    this.handleKeyDown = this.handleKeyDown.bind(this);
  }
  
  async handleKeyDown(event: KeyboardEvent): Promise<void> {
    const binding = this.eventToBinding(event);
    const context = this.buildActionContext();
    
    const keymap = this.registry.findByBinding(binding, context);
    
    if (keymap) {
      event.preventDefault();
      event.stopPropagation();
      
      try {
        await keymap.action(context);
      } catch (error) {
        console.error('Keymap action failed:', error);
      }
    }
  }
  
  attachToWindow(): () => void {
    window.addEventListener('keydown', this.handleKeyDown);
    return () => window.removeEventListener('keydown', this.handleKeyDown);
  }
  
  private eventToBinding(event: KeyboardEvent): KeyBinding {
    return {
      key: event.key.toLowerCase(),
      ctrl: event.ctrlKey,
      shift: event.shiftKey,
      alt: event.altKey,
      meta: event.metaKey
    };
  }
  
  private buildActionContext(): ActionContext {
    const modalContext = this.modalManager.getContext();
    const editingContext = this.modalManager.getEditingContext();
    
    return {
      mode: modalContext.mode,
      route: modalContext.route,
      editingContext: editingContext || undefined,
      focusedElement: document.activeElement as HTMLElement,
      
      // –ü–µ—Ä–µ–¥–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –≤ ActionContext (Dependency Injection)
      commandBus: this.commandBus,         // Command Bus
      modalManager: this.modalManager,
      focusManager: this.focusManager,
      notificationManager: this.notificationManager
    };
  }
}
```

#### KeymapContext (React)

```typescript
// core/keymap/KeymapContext.tsx

import { createContext, useContext, useEffect, useState, ReactNode } from 'react';
import { keymapRegistry, KeymapRegistry } from './KeymapRegistry';
import { KeymapExecutor } from './KeymapExecutor';
import { modalManager } from '../modal/ModalManager';
import { focusManager } from '../focus/FocusManager';
import { notificationManager } from '../notification/NotificationManager';
import { getCommandBus } from '~/composition';
import type { Keymap, ActionContext } from './types';

interface KeymapContextValue {
  registry: KeymapRegistry;
  activeKeymaps: Keymap[];
}

const KeymapContext = createContext<KeymapContextValue | null>(null);

// ‚úÖ Dependency Injection: KeymapExecutor –ø–æ–ª—É—á–∞–µ—Ç –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
const commandBus = getCommandBus();
const keymapExecutor = new KeymapExecutor(
  keymapRegistry,
  commandBus,            // Command Bus —á–µ—Ä–µ–∑ Composition Root
  modalManager,
  focusManager,
  notificationManager
);

export function KeymapProvider({ children }: { children: ReactNode }) {
  const [activeKeymaps, setActiveKeymaps] = useState<Keymap[]>([]);
  
  useEffect(() => {
    // –ü–æ–¥–ø–∏—Å—ã–≤–∞–µ–º—Å—è –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ registry
    const unsubRegistry = keymapRegistry.subscribe(() => {
      updateActiveKeymaps();
    });
    
    // –ü–æ–¥–ø–∏—Å—ã–≤–∞–µ–º—Å—è –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ modalManager
    const unsubModal = modalManager.subscribe(() => {
      updateActiveKeymaps();
    });
    
    // –ü–æ–¥–∫–ª—é—á–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã
    const unsubKeyboard = keymapExecutor.attachToWindow();
    
    updateActiveKeymaps();
    
    return () => {
      unsubRegistry();
      unsubModal();
      unsubKeyboard();
    };
  }, []);
  
  const updateActiveKeymaps = () => {
    const context: ActionContext = {
      mode: modalManager.getMode(),
      route: modalManager.getContext().route,
      editingContext: modalManager.getEditingContext() || undefined
    };
    
    setActiveKeymaps(keymapRegistry.getActiveKeymaps(context));
  };
  
  const value: KeymapContextValue = {
    registry: keymapRegistry,
    activeKeymaps
  };
  
  return (
    <KeymapContext.Provider value={value}>
      {children}
    </KeymapContext.Provider>
  );
}

export function useKeymapContext() {
  const context = useContext(KeymapContext);
  if (!context) {
    throw new Error('useKeymapContext must be used within KeymapProvider');
  }
  return context;
}
```

#### –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∫–µ–π–º–∞–ø–æ–≤

##### Navigation Keymaps
import { Keymap } from '../types';

/**
 * ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û: Keymaps –Ω–µ –∏–º–ø–æ—Ä—Ç–∏—Ä—É—é—Ç –¥—Ä—É–≥–∏–µ Core Systems –Ω–∞–ø—Ä—è–º—É—é
 * –í–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç ActionContext, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –Ω—É–∂–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
 */
export const navigationKeymaps: Keymap[] = [
  {
    id: 'nav-down',
    name: 'Navigate Down',
    binding: { key: 'j' },
    action: (ctx) => {
      // FocusManager –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ ActionContext
      ctx.focusManager?.focusNext();
    },
    description: 'Move focus down',
    modes: ['navigation'],
    icon: 'arrow-down.svg'
  },
  {
    id: 'nav-up',
    name: 'Navigate Up',
    binding: { key: 'k' },
    action: (ctx) => {
      ctx.focusManager?.focusPrevious();
    },
    description: 'Move focus up',
    modes: ['navigation'],
    icon: 'arrow-up.svg'
  },
  {
    id: 'select',
    name: 'Select/Enter',
    binding: { key: 'enter' },
    action: async (ctx) => {
      const focused = ctx.focusManager?.getFocused();
      if (focused?.onEnter) {
        await focused.onEnter();
      }
    },
    description: 'Select focused item',
    modes: ['navigation'],
    icon: 'check.svg'
  },
  {
    id: 'nav-search',
    name: 'Search',
    binding: { key: '/' },
    action: () => {
      const searchInput = document.querySelector('[data-search-input]') as HTMLInputElement;
      searchInput?.focus();
    },
    description: 'Focus search',
    modes: ['navigation'],
    routes: ['/'],
    icon: 'search.svg'
  },
  {
    id: 'nav-home',
    name: 'Go to Home',
    binding: { key: 'h', shift: true },
    action: () => {
      window.location.href = '/';
    },
    description: 'Navigate to home page',
    modes: ['navigation']
  }
];

// core/keymap/keymaps/editing.ts

import { Keymap } from '../types';

/**
 * ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û: –ò—Å–ø–æ–ª—å–∑—É–µ–º ActionContext –≤–º–µ—Å—Ç–æ –ø—Ä—è–º–æ–≥–æ –∏–º–ø–æ—Ä—Ç–∞
 */
export const editingKeymaps: Keymap[] = [
  {
    id: 'exit-edit-mode',
    name: 'Exit Edit Mode',
    binding: { key: 'escape' },
    action: (ctx) => {
      // ModalManager –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ ActionContext
      ctx.modalManager?.enterNavigationMode();
    },
    description: 'Exit edit mode',
    modes: ['editing'],
    icon: 'escape.svg'
  },
  {
    id: 'edit-save',
    name: 'Save Changes',
    binding: { key: 's', ctrl: true },
    action: async (ctx) => {
      // –≠—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è –±—É–¥–µ—Ç –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è—Ç—å—Å—è –Ω–∞ –∫–∞–∂–¥–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ
      const saveHandler = (window as any).__saveHandler;
      if (saveHandler) {
        await saveHandler(ctx);
      }
    },
    description: 'Save changes',
    modes: ['editing'],
    icon: 'save.svg'
  }
];
```

##### Resource Keymaps

```typescript
// core/keymap/keymaps/resource.ts

import { Keymap } from '../types';
import { DeleteResourceCommand } from '~/application/commands';

/**
 * ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û: –ò—Å–ø–æ–ª—å–∑—É–µ–º CommandBus —á–µ—Ä–µ–∑ –∞–±—Å—Ç—Ä–∞–∫—Ü–∏—é
 * –ù–µ –∑–∞–≤–∏—Å–∏–º –æ—Ç Browser API –∏–ª–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–π
 */
export function createResourceKeymaps(): Keymap[] {
  return [
    {
      id: 'resource-delete',
      name: 'Delete Resource',
      binding: { key: 'd', shift: true },
      action: async (ctx) => {
        if (!confirm('Delete this resource?')) return;
        
        const resourceId = ctx.editingContext?.resourceId;
        if (!resourceId) return;
        
        // ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û: –ò—Å–ø–æ–ª—å–∑—É–µ–º Command Bus (Port/Adapter)
        // Keymap –Ω–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç DOM API –∏–ª–∏ UI —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
        await ctx.commandBus?.dispatch(
          new DeleteResourceCommand(resourceId)
        );
      },
      description: 'Delete resource',
      modes: ['navigation'],
      routes: ['/resources/:id'],
      icon: 'trash.svg'
    },
    {
      id: 'resource-add-field',
      name: 'Add Custom Field',
      binding: { key: 'a' },
      action: async (ctx) => {
        // ‚úÖ –ß–µ—Ä–µ–∑ Command Bus
        const { ShowNotificationCommand } = await import('~/application/commands');
        await ctx.commandBus?.dispatch(
          new ShowNotificationCommand('Add field UI would open here', 'info')
        );
      },
      description: 'Add custom field',
      modes: ['navigation'],
      routes: ['/resources/:id', '/resources/new'],
      icon: 'plus.svg'
    },
    {
      id: 'resource-copy',
      name: 'Copy Secret',
      binding: { key: 'c' },
      action: async (ctx) => {
        // ‚úÖ –ß–µ—Ä–µ–∑ Command Bus
        const { CopyToClipboardCommand } = await import('~/application/commands');
        const secretValue = ctx.editingContext?.secretValue || 'secret';
        await ctx.commandBus?.dispatch(
          new CopyToClipboardCommand(secretValue)
        );
      },
      description: 'Copy secret to clipboard',
      modes: ['navigation'],
      routes: ['/resources/:id'],
      icon: 'copy.svg'
    }
  ];
}

```typescript
// core/keymap/keymaps/index.ts

import { KeymapRegistry } from '../KeymapRegistry';
import { navigationKeymaps } from './navigation';
import { editingKeymaps } from './editing';
import { createResourceKeymaps } from './resource';

export function registerAllKeymaps(registry: KeymapRegistry) {
  registry.registerMultiple([
    ...navigationKeymaps,
    ...editingKeymaps,
    ...createResourceKeymaps()
  ]);
}
```

---

### –°–∏—Å—Ç–µ–º–∞ —Ñ
